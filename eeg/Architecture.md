# ğŸ—ï¸ System Architecture - EEG Calmness Monitor

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”‚                    (Web Browser - HTML/CSS/JS)                   â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ Connection   â”‚  â”‚ Calibration  â”‚  â”‚  Prediction  â”‚          â”‚
â”‚  â”‚   Panel      â”‚  â”‚    Panel     â”‚  â”‚    Panel     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚          Live Waveform Chart (Chart.js)            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚        Feature Analysis Chart (Chart.js)           â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FLASK WEB SERVER                            â”‚
â”‚                    (Python Backend - app.py)                     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ REST API     â”‚  â”‚ SocketIO     â”‚  â”‚ State Mgmt   â”‚          â”‚
â”‚  â”‚ Endpoints    â”‚  â”‚ Real-time    â”‚  â”‚ (AppState)   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚         Serial Reader Thread (Background)          â”‚         â”‚
â”‚  â”‚  â€¢ Continuous data acquisition from Arduino        â”‚         â”‚
â”‚  â”‚  â€¢ Buffering and streaming                         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†• Serial (115200 baud)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ARDUINO                                  â”‚
â”‚                  (Hardware Interface)                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  EEG Sensor â†’ ADC (A0) â†’ Serial TX â†’ USB          â”‚         â”‚
â”‚  â”‚  Sampling: 250 Hz (4ms intervals)                  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### 1. Calibration Data Collection Flow

```
User Clicks "Record Calm/Not Calm"
              â†“
    Backend starts recording
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Serial Reader Threadâ”‚
    â”‚ (Continuous Loop)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Read ADC value from Arduino
              â†“
    Convert ADC â†’ Voltage
              â†“
    Add to recording buffer
              â†“
    Emit to frontend via WebSocket
              â†“
    Update live waveform chart
              â†“
    [User watches live signal]
              â†“
    User clicks "Stop Recording"
              â†“
    Save raw data to CSV
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Signal Processing   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Bandpass filter (0.5-40 Hz)
              â†“
    Notch filter (50 Hz)
              â†“
    Save filtered signal
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Feature Extraction  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Sliding window (2s, 0.5s step)
              â†“
    For each window:
      â€¢ Welch's method â†’ PSD
      â€¢ Integrate Alpha band (8-13 Hz)
      â€¢ Integrate Beta band (13-30 Hz)
      â€¢ Calculate Î±/Î² ratio
              â†“
    Save features to CSV
              â†“
    Update status (data available)
```

### 2. Model Training Flow

```
User clicks "Train Model"
              â†“
    Check for both datasets
              â†“
    Load calm_features.csv
    Load not_calm_features.csv
              â†“
    Add labels:
      â€¢ Calm â†’ "Calm"
      â€¢ Not Calm â†’ "Not Calm"
              â†“
    Combine datasets
              â†“
    Shuffle data (random_state=42)
              â†“
    Extract features:
      X = [Alpha, Beta, AlphaBetaRatio]
      y = Labels
              â†“
    Split data:
      70% training
      30% testing
      (stratified by class)
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Feature Scaling     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    StandardScaler:
      â€¢ Fit on training data
      â€¢ Transform train & test
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Model Training      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Logistic Regression:
      â€¢ max_iter: 1000
      â€¢ class_weight: balanced
              â†“
    Fit on training data
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Evaluation          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Predict on test data
              â†“
    Calculate metrics:
      â€¢ Accuracy
      â€¢ Precision
      â€¢ Recall
      â€¢ F1-Score
              â†“
    Save model.pkl
    Save scaler.pkl
    Save training_report.txt
              â†“
    Return accuracy to user
```

### 3. Real-Time Prediction Flow

```
User clicks "Start Prediction"
              â†“
    Load model.pkl
    Load scaler.pkl
              â†“
    Clear prediction buffer
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Continuous Prediction Loop  â”‚
    â”‚ (Runs in Serial Thread)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Read ADC from Arduino
              â†“
    Convert ADC â†’ Voltage
              â†“
    Add to prediction buffer
              â†“
    Emit raw voltage to frontend
              â†“
    Update live waveform
              â†“
    Buffer reaches 500 samples (2s)?
              â†“ Yes
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Signal Processing   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Bandpass filter (0.5-40 Hz)
              â†“
    Notch filter (50 Hz)
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Feature Extraction  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Welch's method â†’ PSD
              â†“
    Calculate Alpha power
    Calculate Beta power
    Calculate Î±/Î² ratio
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Classification      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Create feature vector:
      [Alpha, Beta, Ratio]
              â†“
    Scale features using scaler
              â†“
    Predict class using model
              â†“
    Get prediction probability
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Display Results     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    Emit to frontend:
      â€¢ State (Calm/Not Calm)
      â€¢ Alpha value
      â€¢ Beta value
      â€¢ Ratio value
      â€¢ Confidence
              â†“
    Update prediction display
    Update metrics panel
    Update feature chart
              â†“
    Slide buffer by 125 samples
              â†“
    [Continue loop]
```

---

## Component Architecture

### Frontend Components (HTML/JS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              index.html                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Status Bar Component               â”‚    â”‚
â”‚  â”‚ â€¢ Connection indicator             â”‚    â”‚
â”‚  â”‚ â€¢ Mode display                     â”‚    â”‚
â”‚  â”‚ â€¢ Model status                     â”‚    â”‚
â”‚  â”‚ â€¢ Data availability                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Connection     â”‚  â”‚ Calibration     â”‚   â”‚
â”‚  â”‚ Panel          â”‚  â”‚ Panel           â”‚   â”‚
â”‚  â”‚ â€¢ Port select  â”‚  â”‚ â€¢ Record calm   â”‚   â”‚
â”‚  â”‚ â€¢ Connect btn  â”‚  â”‚ â€¢ Record active â”‚   â”‚
â”‚  â”‚ â€¢ Disconnect   â”‚  â”‚ â€¢ Stop button   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Training Panel                     â”‚    â”‚
â”‚  â”‚ â€¢ Train button                     â”‚    â”‚
â”‚  â”‚ â€¢ Status messages                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Prediction Panel                   â”‚    â”‚
â”‚  â”‚ â€¢ Start/Stop buttons               â”‚    â”‚
â”‚  â”‚ â€¢ State display (large)            â”‚    â”‚
â”‚  â”‚ â€¢ Metrics (Alpha/Beta/Ratio)       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Chart Components                   â”‚    â”‚
â”‚  â”‚ â€¢ Waveform Chart (Chart.js)        â”‚    â”‚
â”‚  â”‚ â€¢ Feature Chart (Chart.js)         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ JavaScript Controllers             â”‚    â”‚
â”‚  â”‚ â€¢ Socket.IO client                 â”‚    â”‚
â”‚  â”‚ â€¢ API client functions             â”‚    â”‚
â”‚  â”‚ â€¢ Chart initialization             â”‚    â”‚
â”‚  â”‚ â€¢ Event handlers                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend Components (Python)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              app.py                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Flask Application                  â”‚    â”‚
â”‚  â”‚ â€¢ Route handlers                   â”‚    â”‚
â”‚  â”‚ â€¢ SocketIO setup                   â”‚    â”‚
â”‚  â”‚ â€¢ Configuration                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ AppState (Global State Manager)    â”‚    â”‚
â”‚  â”‚ â€¢ serial_port                      â”‚    â”‚
â”‚  â”‚ â€¢ is_recording                     â”‚    â”‚
â”‚  â”‚ â€¢ is_predicting                    â”‚    â”‚
â”‚  â”‚ â€¢ buffers (deque)                  â”‚    â”‚
â”‚  â”‚ â€¢ model & scaler                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Signal Processing Module           â”‚    â”‚
â”‚  â”‚ â€¢ bandpass()                       â”‚    â”‚
â”‚  â”‚ â€¢ notch_filter()                   â”‚    â”‚
â”‚  â”‚ â€¢ band_power()                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Pipeline Functions                 â”‚    â”‚
â”‚  â”‚ â€¢ process_calibration_file()       â”‚    â”‚
â”‚  â”‚ â€¢ train_model()                    â”‚    â”‚
â”‚  â”‚ â€¢ process_prediction_window()      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Serial Handler (Background Thread) â”‚    â”‚
â”‚  â”‚ â€¢ serial_reader_thread()           â”‚    â”‚
â”‚  â”‚ â€¢ Continuous ADC reading           â”‚    â”‚
â”‚  â”‚ â€¢ Data routing (record/predict)    â”‚    â”‚
â”‚  â”‚ â€¢ WebSocket emission               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ API Routes                         â”‚    â”‚
â”‚  â”‚ GET  /                             â”‚    â”‚
â”‚  â”‚ GET  /api/ports                    â”‚    â”‚
â”‚  â”‚ POST /api/connect                  â”‚    â”‚
â”‚  â”‚ POST /api/disconnect               â”‚    â”‚
â”‚  â”‚ POST /api/start_recording          â”‚    â”‚
â”‚  â”‚ POST /api/stop_recording           â”‚    â”‚
â”‚  â”‚ POST /api/train_model              â”‚    â”‚
â”‚  â”‚ POST /api/start_prediction         â”‚    â”‚
â”‚  â”‚ POST /api/stop_prediction          â”‚    â”‚
â”‚  â”‚ GET  /api/status                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ SocketIO Events                    â”‚    â”‚
â”‚  â”‚ â€¢ waveform_data (emit)             â”‚    â”‚
â”‚  â”‚ â€¢ prediction_data (emit)           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Threading Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Main Thread (Flask)             â”‚
â”‚                                         â”‚
â”‚  â€¢ Handle HTTP requests                â”‚
â”‚  â€¢ Route to handlers                   â”‚
â”‚  â€¢ Manage WebSocket connections        â”‚
â”‚  â€¢ Return responses                    â”‚
â”‚                                         â”‚
â”‚  Spawns:                               â”‚
â”‚    â†“                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Serial Reader Thread (Daemon)       â”‚
â”‚                                         â”‚
â”‚  Infinite Loop:                        â”‚
â”‚    1. Check serial port availability   â”‚
â”‚    2. Read incoming byte                â”‚
â”‚    3. Decode ADC value                 â”‚
â”‚    4. Convert to voltage               â”‚
â”‚    5. Add to buffer                    â”‚
â”‚    6. Emit to frontend (if needed)     â”‚
â”‚    7. Process prediction (if active)   â”‚
â”‚    8. Sleep 1ms                        â”‚
â”‚                                         â”‚
â”‚  Thread-Safe Operations:               â”‚
â”‚    â€¢ AppState (shared state)           â”‚
â”‚    â€¢ SocketIO emit (thread-safe)       â”‚
â”‚    â€¢ Serial port (locked)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    IDLE     â”‚ (Initial state)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ User connects to port
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONNECTED  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â†’ Start recording â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚   RECORDING    â”‚
       â”‚                      â”‚   (calm/active)â”‚
       â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                              â”‚
       â”‚                              â”‚ Stop recording
       â”‚                              â†“
       â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                      â”‚  PROCESSING    â”‚
       â”‚                      â”‚  (automatic)   â”‚
       â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                              â”‚
       â”‚                              â†“
       â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  CONNECTED     â”‚
       â”‚    â”‚                 â”‚  (data saved)  â”‚
       â”‚    â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚    â”‚
       â”‚    â”‚ Both datasets collected
       â”‚    â†“
       â”‚ Train model â†’ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚   TRAINING     â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚                        â”‚ Model trained
       â”‚                        â†“
       â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚  MODEL READY   â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚                        â”‚ Start prediction
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
       â”‚                        â†“
       â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚  PREDICTING    â”‚
       â”‚                â”‚  (real-time)   â”‚
       â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                        â”‚
       â”‚                        â”‚ Stop prediction
       â”‚                        â†“
       â†“                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  MODEL READY   â”‚
â”‚  CONNECTED  â”‚â†â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
       â”‚                                 â”‚
       â”‚ Disconnect                      â”‚
       â†“                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚    IDLE     â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File System Structure

```
eeg-calmness-monitor/
â”‚
â”œâ”€â”€ app.py                    # Main Flask application
â”œâ”€â”€ requirements.txt          # Python dependencies
â”œâ”€â”€ README.md                 # Main documentation
â”œâ”€â”€ QUICKSTART.md            # Quick start guide
â”œâ”€â”€ FEATURES.md              # Feature documentation
â”œâ”€â”€ ARCHITECTURE.md          # This file
â”œâ”€â”€ run.sh                   # Linux/Mac startup script
â”œâ”€â”€ run.bat                  # Windows startup script
â”œâ”€â”€ arduino_eeg_sketch.ino   # Arduino code
â”‚
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html           # Web interface
â”‚
â””â”€â”€ data/                    # Auto-created during runtime
    â”‚
    â”œâ”€â”€ calibration/         # Raw calibration recordings
    â”‚   â”œâ”€â”€ calm_raw.csv
    â”‚   â””â”€â”€ not_calm_raw.csv
    â”‚
    â”œâ”€â”€ pipeline_output/     # Processed signals & features
    â”‚   â”œâ”€â”€ calm_filtered.csv
    â”‚   â”œâ”€â”€ calm_features.csv
    â”‚   â”œâ”€â”€ not_calm_filtered.csv
    â”‚   â””â”€â”€ not_calm_features.csv
    â”‚
    â”œâ”€â”€ models/              # Trained ML models
    â”‚   â”œâ”€â”€ model.pkl
    â”‚   â”œâ”€â”€ scaler.pkl
    â”‚   â””â”€â”€ training_report.txt
    â”‚
    â””â”€â”€ results/             # Future: prediction logs
```

---

## Technology Stack

### Frontend
- **HTML5**: Structure
- **CSS3**: Styling with custom properties
- **JavaScript (ES6)**: Application logic
- **Chart.js 4.4**: Real-time charting
- **Socket.IO 4.5**: WebSocket communication

### Backend
- **Python 3.8+**: Core language
- **Flask 3.0**: Web framework
- **Flask-SocketIO 5.3**: WebSocket support
- **PySerial 3.5**: Serial communication
- **NumPy 1.24**: Numerical computing
- **Pandas 2.0**: Data manipulation
- **SciPy 1.11**: Signal processing
- **Scikit-learn 1.3**: Machine learning
- **Joblib 1.3**: Model serialization

### Hardware
- **Arduino**: Data acquisition
- **EEG Sensor**: Neural signal capture
- **USB Serial**: Communication interface

---

## Performance Characteristics

### Latency Analysis
```
Component                    Latency
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Arduino ADC sampling         4 ms
Serial transmission          < 1 ms
Python serial read           < 1 ms
Voltage conversion           < 0.1 ms
Buffer append                < 0.1 ms
WebSocket emit               < 5 ms
Chart update                 < 10 ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total (acquisition â†’ display): ~20 ms

Prediction Processing:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Filter (500 samples)         5-10 ms
Welch's method               10-20 ms
Feature extraction           < 1 ms
Model prediction             < 1 ms
Result emission              < 5 ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total (window â†’ prediction): ~40 ms
```

### Resource Usage
```
Memory:
  â€¢ Flask server: ~50-100 MB
  â€¢ Data buffers: ~10 MB
  â€¢ Charts: ~20 MB
  â€¢ Total: ~100-150 MB

CPU:
  â€¢ Idle: 1-2%
  â€¢ Recording: 5-10%
  â€¢ Predicting: 10-15%

Disk:
  â€¢ Per 5-min recording: ~1-2 MB
  â€¢ Model files: < 1 MB
  â€¢ Total project: ~5-10 MB
```

---

## Security Considerations

### Current Implementation
- **Local Only**: Runs on localhost
- **No Authentication**: Single user assumed
- **No Encryption**: Local communication only
- **File System**: Unrestricted local access

### Future Enhancements
- User authentication
- HTTPS support
- Data encryption
- Access control
- Session management
- Rate limiting

---

## Scalability

### Current Limitations
- Single user at a time
- Single serial connection
- Local file storage
- In-memory buffering

### Potential Improvements
- Multiple user sessions
- Multiple sensor support
- Database storage (PostgreSQL)
- Cloud deployment
- Load balancing
- Microservices architecture

---

## Testing Strategy

### Unit Tests (Future)
- Signal processing functions
- Feature extraction
- Model training pipeline
- API endpoints

### Integration Tests
- Serial communication
- WebSocket events
- File operations
- Model save/load

### Manual Testing
- Hardware connection
- Data collection
- Real-time prediction
- UI responsiveness

---

## Deployment Options

### Local Development
```bash
python app.py
# Accessible at http://localhost:5000
```

### Production (Future)
```bash
# Using Gunicorn + Nginx
gunicorn -k eventlet -w 1 app:app

# Using Docker
docker build -t eeg-monitor .
docker run -p 5000:5000 --device=/dev/ttyUSB0 eeg-monitor
```

---

## Maintenance & Monitoring

### Logs
- Flask application logs
- Serial communication errors
- Model training reports
- WebSocket events

### Monitoring Points
- Serial connection health
- Data acquisition rate
- Prediction latency
- Model accuracy

### Backup Strategy
- Regular model backups
- Calibration data archives
- Configuration exports

---

**This architecture provides a solid foundation for real-time EEG monitoring and classification! ğŸ§ âš¡**